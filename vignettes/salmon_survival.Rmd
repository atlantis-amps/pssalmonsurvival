---
title: "salmon_survival"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{salmon_survival}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup}
install.packages("rnaturalearthhires", repos = "http://packages.ropensci.org", type = "source")
library(pssalmonsurvival)


```

Map of model extent in Puget Sound

```{r map model extent, echo=TRUE}

file.name <- "amps_model_map.png"

make_map(file.name)
```


Model ensemble was developed with alternate parametrizations. Plot biomass trajectories based on simulations that run the model ensemble 30 years under constant fishing rates. We only use 6 model variants, 2:5 and 7:8

```{r}

data("ensemblebiomass")
plotmodels <- c(1,6) # eliminated model versions 1 & 6

plot_ensemblebiomass(ensemblebiomass, plotmodels)

```


Plot salmon survival for model ensemble, survival is defined as the proportion of age 1 salmon that survive to age 5, the cohort is lagged over time. 

```{r}
data("ensemblenumbersage")
data("salmongroups")
plotmodels <- c(1,6) # eliminated model versions 1 & 6

plot_ensemble_survival(ensemblenumbersage, salmongroups, plotmodels)

```

make forcings for model simulations

```{r}

#groups for scenarios
sim.groups <- c("Pinniped", "California_sea_lion", "Harbor_seal", 
                "PinkSY_Fish", "ChumFSY_Fish", 
                "Herring_PS", "Herring_Cherry",
                "Porpoise",
                "Spinydog_Fish", 
                "Pisc_Seabird","NonPisc_Seabird",
                "Gel_Zoo", 
                "ChinookY_Fish","ChinookSY_Fish","CohoHY_Fish","ChumHSY_Fish",
                #chinook hatchery are repeated twice for a scenario with just Chinook
                "ChinookY_Fish_2","ChinookSY_Fish_2")

func.groups <- readr::read_csv(here::here("modelfiles","PugetSoundAtlantisFunctionalGroups.csv"))

lapply(sim.groups, make_forcing, ncfile = "AMPS.nc", func.groups, num.forcing.years = 50, rate.multiplier = 0.8, bash.file = "amps_cal.sh", force.prm = "PugetSound_force.prm")


lapply(sim.groups, make_forcing, ncfile = "AMPS.nc", func.groups, num.forcing.years = 50, rate.multiplier = 1.2, bash.file = "amps_cal.sh", force.prm = "PugetSound_force.prm")

```

